openapi: 3.0.0
paths:
  /:
    get:
      operationId: AppController_getHello
      parameters: []
      responses:
        "200":
          description: ""
      tags:
        - App
  /auth/register:
    post:
      description: Creates a new user account. By default, email verification is required.
      operationId: AuthController_register
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterDto"
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegisterResponseDto"
        "400":
          description: Invalid input or email already exists
      summary: Register a new user
      tags: &a1
        - auth
  /auth/login:
    post:
      description: Authenticates a user and returns access and refresh tokens
      operationId: AuthController_login
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginDto"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponseDto"
        "401":
          description: Invalid credentials
      summary: Login user
      tags: *a1
  /auth/refresh:
    post:
      description: Generates a new access token using a valid refresh token
      operationId: AuthController_refresh
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenDto"
      responses:
        "200":
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponseDto"
        "401":
          description: Invalid or expired refresh token
      summary: Refresh access token
      tags: *a1
  /auth/logout:
    post:
      description: Invalidates the refresh token and logs out the user
      operationId: AuthController_logout
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenDto"
      responses:
        "204":
          description: Logout successful
        "401":
          description: Invalid refresh token
      summary: Logout user
      tags: *a1
  /auth/verify-email:
    get:
      description: Verifies user email using the token sent via email
      operationId: AuthController_verifyEmail
      parameters:
        - name: token
          required: true
          in: query
          description: Email verification token received via email
          schema:
            example: abc123def456
            type: string
      responses:
        "200":
          description: Email verified successfully
        "400":
          description: Invalid or expired token
      summary: Verify email address
      tags: *a1
  /auth/resend-verification:
    post:
      description: Sends a new email verification link to the authenticated user
      operationId: AuthController_resendVerification
      parameters: []
      responses:
        "200":
          description: Verification email sent
        "401":
          description: Unauthorized
      security:
        - bearer: []
      summary: Resend verification email
      tags: *a1
  /auth/request-password-reset:
    post:
      description: Sends a password reset link to the provided email address if it exists
      operationId: AuthController_requestPasswordReset
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RequestPasswordResetDto"
      responses:
        "200":
          description: Password reset request processed
      summary: Request password reset
      tags: *a1
  /auth/reset-password:
    post:
      description: Resets user password using the token received via email
      operationId: AuthController_resetPassword
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordDto"
      responses:
        "200":
          description: Password reset successfully
        "400":
          description: Invalid or expired token
      summary: Reset password
      tags: *a1
  /me:
    get:
      description: Retrieves the profile of the authenticated user
      operationId: UsersController_getProfile
      parameters: []
      responses:
        "200":
          description: Profile retrieved successfully
        "401":
          description: Unauthorized
      security: &a2
        - bearer: []
      summary: Get current user profile
      tags: &a3
        - me
    patch:
      description: Updates the profile of the authenticated user
      operationId: UsersController_updateProfile
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProfileDto"
      responses:
        "200":
          description: Profile updated successfully
        "400":
          description: Invalid input data
        "401":
          description: Unauthorized
      security: *a2
      summary: Update current user profile
      tags: *a3
  /todos:
    post:
      description: Creates a new todo item for the authenticated user
      operationId: TodosController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTodoDto"
      responses:
        "201":
          description: Todo created successfully
        "400":
          description: Invalid input data
        "401":
          description: Unauthorized
      security: &a4
        - bearer: []
      summary: Create a new todo
      tags: &a5
        - todos
    get:
      description: Retrieves all todos. Regular users see only their own todos, while
        admins and sysadmins see all todos.
      operationId: TodosController_findAll
      parameters: []
      responses:
        "200":
          description: List of todos retrieved successfully
        "401":
          description: Unauthorized
      security: *a4
      summary: Get all todos
      tags: *a5
  /todos/{id}:
    get:
      description: Retrieves a specific todo by its ID. Regular users can only access
        their own todos.
      operationId: TodosController_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: Todo retrieved successfully
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Not authorized to access this todo
        "404":
          description: Todo not found
      security: *a4
      summary: Get a todo by ID
      tags: *a5
    patch:
      description: Updates a todo by its ID. Regular users can only update their own todos.
      operationId: TodosController_update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateTodoDto"
      responses:
        "200":
          description: Todo updated successfully
        "400":
          description: Invalid input data
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Not authorized to update this todo
        "404":
          description: Todo not found
      security: *a4
      summary: Update a todo
      tags: *a5
    delete:
      description: Deletes a todo by its ID. Regular users can only delete their own todos.
      operationId: TodosController_remove
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "204":
          description: Todo deleted successfully
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Not authorized to delete this todo
        "404":
          description: Todo not found
      security: *a4
      summary: Delete a todo
      tags: *a5
  /admin/users:
    get:
      description: Retrieves all users in the system. Requires admin or sysadmin role.
      operationId: AdminController_getAllUsers
      parameters: []
      responses:
        "200":
          description: List of users retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/UserResponseDto"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Requires admin or sysadmin role
      security: &a6
        - bearer: []
      summary: Get all users
      tags: &a7
        - admin
  /admin/users/{id}:
    get:
      description: Retrieves a specific user by their ID. Requires admin or sysadmin role.
      operationId: AdminController_getUserById
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: User retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponseDto"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Requires admin or sysadmin role
        "404":
          description: User not found
      security: *a6
      summary: Get user by ID
      tags: *a7
    patch:
      description: Updates a user by their ID. Can update email, password, full name,
        role, and email verification status. Requires sysadmin role.
      operationId: AdminController_updateUser
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserDto"
      responses:
        "200":
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponseDto"
        "400":
          description: Invalid input data
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Requires sysadmin role
        "404":
          description: User not found
      security: *a6
      summary: Update user
      tags: *a7
    delete:
      description: Deletes a user by their ID. Requires sysadmin role.
      operationId: AdminController_deleteUser
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "204":
          description: User deleted successfully
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Requires sysadmin role
        "404":
          description: User not found
      security: *a6
      summary: Delete user
      tags: *a7
  /health:
    get:
      description: Basic health check endpoint. Returns OK if the service is running.
        Used for liveness probes in container orchestration.
      operationId: HealthController_health
      parameters: []
      responses:
        "200":
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    example: 2025-01-01T00:00:00.000Z
      summary: Health check
      tags: &a8
        - health
  /readiness:
    get:
      description: Readiness check endpoint that verifies database connectivity.
        Returns OK if all dependencies are available. Used for readiness probes
        in container orchestration.
      operationId: HealthController_readiness
      parameters: []
      responses:
        "200":
          description: Service is ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                    enum:
                      - ok
                      - degraded
                  checks:
                    type: object
                    properties:
                      database:
                        type: string
                        example: ok
                        enum:
                          - ok
                          - fail
                  timestamp:
                    type: string
                    example: 2025-01-01T00:00:00.000Z
      summary: Readiness check
      tags: *a8
info:
  title: Todo App API
  description: REST API for Todo Application with authentication and role-based
    access control
  version: "1.0"
  contact: {}
tags: []
servers: []
components:
  securitySchemes:
    bearer:
      scheme: bearer
      bearerFormat: JWT
      type: http
  schemas:
    RegisterDto:
      type: object
      properties:
        email:
          type: string
          description: User email address
          example: newuser@example.com
        password:
          type: string
          description: User password (minimum 8 characters)
          example: securePassword123
          minLength: 8
          maxLength: 128
        fullName:
          type: string
          description: User full name
          example: John Doe
          minLength: 1
          maxLength: 255
        autoverify:
          type: boolean
          description: Auto-verify email (for testing purposes)
          example: false
          default: false
        role:
          type: string
          description: User role
          enum:
            - guest
            - admin
            - sysadmin
          example: guest
          default: guest
      required:
        - email
        - password
        - fullName
    RegisteredUserInfo:
      type: object
      properties:
        id:
          type: string
          description: User ID
          example: uuid-123
        email:
          type: string
          description: User email
          example: newuser@example.com
        fullName:
          type: string
          description: User full name
          example: John Doe
        role:
          type: string
          description: User role
          enum:
            - guest
            - admin
            - sysadmin
          example: guest
        emailVerified:
          type: boolean
          description: Email verification status
          example: false
      required:
        - id
        - email
        - fullName
        - role
        - emailVerified
    RegisterResponseDto:
      type: object
      properties:
        user:
          description: Registered user information
          allOf:
            - $ref: "#/components/schemas/RegisteredUserInfo"
      required:
        - user
    LoginDto:
      type: object
      properties:
        email:
          type: string
          description: User email address
          example: user@example.com
        password:
          type: string
          description: User password
          example: securePassword123
      required:
        - email
        - password
    UserInfo:
      type: object
      properties:
        id:
          type: string
          description: User ID
          example: uuid-123
        email:
          type: string
          description: User email
          example: user@example.com
        fullName:
          type: string
          description: User full name
          example: John Doe
        role:
          type: string
          description: User role
          enum:
            - guest
            - admin
            - sysadmin
          example: guest
        emailVerified:
          type: boolean
          description: Email verification status
          example: true
      required:
        - id
        - email
        - fullName
        - role
        - emailVerified
    AuthResponseDto:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT access token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          description: JWT refresh token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        user:
          description: User information
          allOf:
            - $ref: "#/components/schemas/UserInfo"
      required:
        - accessToken
        - refreshToken
        - user
    RefreshTokenDto:
      type: object
      properties:
        refreshToken:
          type: string
          description: Refresh token received from login or previous refresh
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      required:
        - refreshToken
    RequestPasswordResetDto:
      type: object
      properties:
        email:
          type: string
          description: Email address to send password reset link
          example: user@example.com
      required:
        - email
    ResetPasswordDto:
      type: object
      properties:
        token:
          type: string
          description: Password reset token received via email
          example: abc123def456
        newPassword:
          type: string
          description: New password (minimum 8 characters)
          example: newSecurePassword123
          minLength: 8
      required:
        - token
        - newPassword
    UpdateProfileDto:
      type: object
      properties:
        fullName:
          type: string
          description: User full name
          example: Jane Smith
          minLength: 1
          maxLength: 255
    CreateTodoDto:
      type: object
      properties:
        description:
          type: string
          description: Description of the todo item
          example: Buy groceries for the week
        dueDate:
          format: date-time
          type: string
          description: Due date for the todo item
          example: 2025-12-31T23:59:59.000Z
        priority:
          type: string
          description: Priority level of the todo item
          enum:
            - low
            - medium
            - high
          example: medium
      required:
        - description
    UpdateTodoDto:
      type: object
      properties:
        description:
          type: string
          description: Description of the todo item
          example: Buy groceries for the week
        dueDate:
          format: date-time
          type: string
          description: Due date for the todo item
          example: 2025-12-31T23:59:59.000Z
        priority:
          type: string
          description: Priority level of the todo item
          enum:
            - low
            - medium
            - high
          example: medium
    UserResponseDto:
      type: object
      properties:
        id:
          type: string
          description: User ID
          example: uuid-123
        email:
          type: string
          description: User email address
          example: user@example.com
        fullName:
          type: string
          description: User full name
          example: John Doe
        role:
          type: string
          description: User role
          example: guest
        emailVerifiedAt:
          type: object
          description: Email verification timestamp
          example: 2025-01-01T00:00:00.000Z
          nullable: true
        createdAt:
          format: date-time
          type: string
          description: User creation timestamp
          example: 2025-01-01T00:00:00.000Z
        updatedAt:
          format: date-time
          type: string
          description: User last update timestamp
          example: 2025-01-01T00:00:00.000Z
      required:
        - id
        - email
        - fullName
        - role
        - emailVerifiedAt
        - createdAt
        - updatedAt
    UpdateUserDto:
      type: object
      properties:
        email:
          type: string
          description: User email address
          example: user@example.com
        password:
          type: string
          description: User password (minimum 8 characters)
          example: newPassword123
          minLength: 8
          maxLength: 128
        fullName:
          type: string
          description: User full name
          example: John Doe
          minLength: 1
          maxLength: 255
        role:
          type: string
          description: User role
          enum:
            - guest
            - admin
            - sysadmin
          example: guest
        emailVerifiedAt:
          type: object
          description: Email verification timestamp (ISO 8601 format, or null to unverify)
          example: 2025-01-01T00:00:00.000Z
